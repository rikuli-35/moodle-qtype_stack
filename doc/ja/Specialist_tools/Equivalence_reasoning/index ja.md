# 同値変形入門

同値変形（reasoning by equivalence）の機能は、設計上、比較的シンプルなものとなっています。現在サポートしているのは以下の通りです。

- 基本的な1変数多項式
- 簡単な不等式
- 簡単な連立方程式

対数や三角関数を含む代数的操作のサポートはありませんが、個々の例では動作する場合があります。

## 初めての問題の作成

このガイドでは、行ごとの同値変形入力タイプを使用したSTACK問題の作成方法を説明します。

例として、学生に3次式 \\((x+2)^3\\) を一行ずつ段階的に展開させ、その途中計算を示させたい場合を考えます。この問題に対する学生の解答からは、以下の知識と能力を評価できます。

1. 括弧の展開
2. 同類項の整理

これらの能力を評価するためには途中の計算過程を示させる必要があります。

新しいSTACK問題を作成し、適切な名前を付けた後、以下を問題変数欄にコピーしてください。

    p:(x+2)^3;
    taf:ev(expand(p),simp);
    ta:[(x+2)^3,stackeq((x+2)*(x+2)^2),stackeq((x+2)*(x^2+4*x+4)),stackeq(x^3+4*x^2+4*x+2*x^2+8*x+8),stackeq(taf)];

最初の変数 `p` は問題で使用する式です。変数 `taf` は最終的な模範解答です。
変数 `ta` は、学生が最終解答に至るまでに示すことが期待される各ステップを含むリストです。

\\((x+2)^{3}\\)

\\(=(x+2)(x+2)^{2}\\)

\\(=(x+2)(x^{2}+4x+4)\\)

\\(=x^{3}+4x^{2}+4x+2x^{2}+8x+8\\)

\\(=x^{3}+6x^{2}+12x+8\\)

注意事項：

- CAS関数 `expand()` と `ev(...,simp)` を使用して `expand()` の出力を簡略化し、模範解答を求めています。
- 特殊関数 `stackeq` は単項等号に置き換えられます。Maximaでは等号は中置演算子 \\(a=b\\) として使用されるため、単項前置演算子 \\(=b\\) は使えません。そのため、STACKではこの特殊な演算子が必要です。学生は入力エリアで行頭を \\(=\\) から始めることができますが、教師側ではそれができません。

この文脈では、教師の答えも学生の答えもリストです。解答全体が1つのオブジェクトとして評価されます。

以下のテキストを問題テキスト欄にコピーしてください。

    Expand {@p@}, remembering to show your working.
    [[input:ans1]] [[validation:ans1]]

### 解答欄オプションの設定

`Input:ans1` ヘッダの下で、解答形式のドロップダウンから「同値変形」を選択し、正解として `ta` を指定します。

学生に展開を一行ずつ進めさせたいので、ヒントを含めましょう。`Input:ans1` ヘッダ内の書式のヒント欄に以下をコピーしてください。

    [(x+2)^3,stackeq(?)]

これはリスト形式であり、`stackeq` を使用しています。

この文脈では、学生に対して「*を自動挿入する」を設定し、最も寛容な入力構文を提供するのがおそらく合理的ですが、これはオプションです。

学生の解答の最初の行が問題の最初の行と一致するかをSTACKに比較させる必要があります。これにより、学生が「正しい問題に答えている」ことを確認できます。
`Input:ans1` ヘッダ内のその他のオプション欄に `firstline` と入力してください。
これにより、正しい最初の行がない場合、学生の解答は無効と判定されます。

`firstline` は書式のヒント欄でも使用できます。その場合、学生が問題を開いた時点で最初の行が解答欄にあらかじめ表示されます。

### ポテンシャル・レスポンス・ツリーの設定

最小限のポテンシャル・レスポンス・ツリーとして、1つのノードを設定します。

    評価関数 = EquivFirst
    評価対象 = ans1
    評価基準 = ta
    自動簡略化 = いいえ

なお、`自動簡略化` フィールドはPRTのノード内ではなく、PRTのオプションにあります。

### 問題オプションの設定

オプションセクションで、以下の設定により簡略化をオフにします。

    自動簡略化 = いいえ

問題を保存してください。これで最小限の動作する問題ができあがるので、プレビューし、少なくとも1つの問題テストを追加してください。

## より具体的なフィードバック

この時点で、問題は以下のことのみを確認しています。

1. 学生は正しい式から出発しているか。具体的には、学生の論証の最初の行が `ta` の最初の行と `EqualComAss` テスト（可換性と結合性に基づく等価性判定）によって同値であるか。
2. 学生の解答の各行がすべて代数的に同値であるか。

完全で有意義な問題にするためには、明らかに追加の設定が必要です。

この時点で、[同値変形](Equivalence_input.md)入力タイプのドキュメントをお読みください。

## 正しい結果への到達

おそらく学生には最終的に式 \\(x^{3}+6x^{2}+12x+8\\) に到達してほしいでしょう。

学生がこの結果に到達したかを確認するには、PRTにもう1つノードを追加します。ノード1が真（つまり、学生が正しい場所から出発し、間違いを犯していない場合）であれば、ノード2に接続します。
ノード2は以下のように設定します。

    評価対象 = last(ans1)
    評価基準 = last(ta)
    評価関数 = EqualComAss
    自動簡略化 = いいえ

このノードは、学生が正しい結果に到達したかを確認するフィードバックを追加します。

なお、`EqualComAss` を使用することで、\\(x^{3}+6x^{2}+12x+8\\) も \\(x^{3}+x^{2}6+8+12x\\) も受け入れられます。
項の順序も含めて、例えば \\(x^{3}+6x^{2}+12x+8\\) という特定の順序を求める場合は、評価関数として `CasEqual` を使用してください。

## 正当なステップとは何か

現時点では、同値である式はすべて正当なステップとみなされます。

これは明らかに完全に満足のいくものではありません。現在の開発段階では「ステップ」の概念は定義されておらず、実際にこれを定義することは非常に困難と思われます。将来的に「ステップサイズ」のチェックのためのより良いツールを開発する予定であり、この方向への貢献は歓迎します。

教師は `length(ta)` を参照することで、学生の解答が十分な長さであるか、あるいは長すぎないかを確認できます。

教師は、学生の解答の中に特定の式が含まれているかどうかを確認できます。この検索を容易にするために、関数 `stack_equiv_find_step(ex, exl)` を提供しています。この関数は、`ATEqualComAss` を使用して式 `ex` をリスト `exl` の中から検索し、一致した位置のインデックスのリストを返します。式が含まれていないかどうかだけを知りたい場合は、述語関数 `emptyp` を使用してください。

別の方法として、以下のコードを[フィードバック変数](../../Authoring/Variables.md)に記述することで、因数分解された形式が学生の解答のどこかに存在するかを確認できます。

    foundfac:sublist(ans1,lambda([ex], equationp(ex) and is(rhs(ex)=0)));
    foundfac:ev(any_listp(lambda([ex], second(ATFacForm(lhs(ex),lhs(ex),x))), foundfac), simp);

この段階では、STACK内に組み込まれた機能はまだ少ない状態です。多くのことが可能ですが、上記の例が示すように、問題作成者は他の問題タイプに比べてより多くのMaximaコードを記述する必要があります。

この機能は今後数年かけて、実際の使用を通じて開発されていく予定です。
この機能がどのように動作すべきかについて経験や見解をお持ちの方は、開発者にご連絡ください。

## 長期的な計画

1. \\(x\\neq a\\) 演算子の定義。定義域から特定の数値を除外するために必要です。
2. \\(x\\in X\\) 演算子の定義（学生使用向け）。
3. 特定のステップの確認など、評価のためのより良いツールの提供。
4. 学生がどのステップを踏んだか、どこで問題が生じたかについて、より良いフィードバックの提供。

長期的には、論文 Sangwin, C.J. __An Audited Elementary Algebra__ The Mathematical Gazette, July 2015 のアイデアを完全に実装する可能性があります。

将来的には、学生が操作を実行するだけでなく、「両辺に \\(a\\) を加える」のように自分が行っていることを説明することも期待されるかもしれません。具体的にどのようにこれを実現するか、教師に提供されるオプションがいかなるものになるかは、今後最も変更される可能性が高い部分です。

また、「模範解答」の概念を導入したいと考えています。STACKが、学生の解答がこの模範解答にどの程度沿っているかを判定できるようになるでしょう。
