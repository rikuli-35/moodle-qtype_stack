# 同値変形入門

同値変形（reasoning by equivalence）の機能は、設計上、比較的シンプルなものとなっている。現在サポートしているのは以下の通りである。

- 基本的な1変数多項式
- 簡単な不等式
- 簡単な連立方程式

対数や三角関数を含む代数的操作のサポートはないが、個々の例では動作する場合がある。

## 初めての問題の作成

このガイドでは、行ごとの同値変形入力タイプを使用したSTACK問題の作成方法を説明する。

例として、学生に3次式 \\((x+2)^3\\) を一行ずつ段階的に展開させ、その途中計算を示させたい場合を考える。この問題に対する学生の解答からは、以下の知識と能力を評価できる。

1. 括弧の展開
2. 同類項の整理

これらの能力を評価するためには途中の計算過程を示させる必要がある。

新しいSTACK問題を作成し、適切な名前を付けた後、以下を問題変数欄にコピーする。

    p:(x+2)^3;
    taf:ev(expand(p),simp);
    ta:[(x+2)^3,stackeq((x+2)*(x+2)^2),stackeq((x+2)*(x^2+4*x+4)),stackeq(x^3+4*x^2+4*x+2*x^2+8*x+8),stackeq(taf)];

最初の変数 `p` は問題で使用する式である。変数 `taf` は最終的な模範解答である。
変数 `ta` は、学生が最終解答に至るまでに示すことが期待される各ステップを含むリストである。

\\((x+2)^{3}\\)

\\(=(x+2)(x+2)^{2}\\)

\\(=(x+2)(x^{2}+4x+4)\\)

\\(=x^{3}+4x^{2}+4x+2x^{2}+8x+8\\)

\\(=x^{3}+6x^{2}+12x+8\\)

注意事項：

- CAS関数 `expand()` と `ev(...,simp)` を使用して `expand()` の出力を簡略化し、模範解答を求めている。
- 特殊関数 `stackeq` は単項等号に置き換えられる。Maximaでは等号は中置演算子 \\(a=b\\) として使用されるため、単項前置演算子 \\(=b\\) は使えない。そのため、STACKではこの特殊な演算子が必要である。学生は入力エリアで行頭を \\(=\\) から始めることができるが、教師側ではそれができない。

この文脈では、教師の答えも学生の答えもリストである。解答全体が1つのオブジェクトとして評価される。

以下のテキストを問題テキスト欄にコピーする。

    Expand {@p@}, remembering to show your working.
    [[input:ans1]] [[validation:ans1]]

### 解答欄オプションの設定

`Input:ans1` ヘッダの下で、解答形式のドロップダウンから「同値変形」を選択し、正解として `ta` を指定する。

学生に展開を一行ずつ進めさせたいので、ヒントを含める。`Input:ans1` ヘッダ内の書式のヒント欄に以下をコピーする。

    [(x+2)^3,stackeq(?)]

これはリスト形式であり、`stackeq` を使用している。

この文脈では、学生に対して「*を自動挿入する」を設定し、最も寛容な入力構文を提供するのがおそらく合理的であるが、これはオプションである。

学生の解答の最初の行が問題の最初の行と一致するかをSTACKに比較させる必要がある。これにより、学生が「正しい問題に答えている」ことを確認できる。
`Input:ans1` ヘッダ内のその他のオプション欄に `firstline` と入力する。
これにより、正しい最初の行がない場合、学生の解答は無効と判定される。

`firstline` は書式のヒント欄でも使用できる。その場合、学生が問題を開いた時点で最初の行が解答欄にあらかじめ表示される。

### ポテンシャル・レスポンス・ツリーの設定

最小限のポテンシャル・レスポンス・ツリーとして、1つのノードを設定する。

    評価関数 = EquivFirst
    評価対象 = ans1
    評価基準 = ta
    自動簡略化 = いいえ

なお、`自動簡略化` フィールドはPRTのノード内ではなく、PRTのオプションにある。

### 問題オプションの設定

オプションセクションで、以下の設定により簡略化をオフにする。

    自動簡略化 = いいえ

問題を保存する。これで最小限の動作する問題ができあがるので、プレビューし、少なくとも1つの問題テストを追加する。

## より具体的なフィードバック

この時点で、問題は以下のことのみを確認している。

1. 学生は正しい式から出発しているか。具体的には、学生の論証の最初の行が `ta` の最初の行と `EqualComAss` テスト（可換性と結合性に基づく等価性判定）によって同値であるか。
2. 学生の解答の各行がすべて代数的に同値であるか。

完全で有意義な問題にするためには、明らかに追加の設定が必要である。

この時点で、[同値変形](Equivalence_input.md)入力タイプのドキュメントを読むことを推奨する。

## 正しい結果への到達

おそらく学生には最終的に式 \\(x^{3}+6x^{2}+12x+8\\) に到達してほしいであろう。

学生がこの結果に到達したかを確認するには、PRTにもう1つノードを追加する。ノード1が真（つまり、学生が正しい場所から出発し、間違いを犯していない場合）であれば、ノード2に接続する。
ノード2は以下のように設定する。

    評価対象 = last(ans1)
    評価基準 = last(ta)
    評価関数 = EqualComAss
    自動簡略化 = いいえ

このノードは、学生が正しい結果に到達したかを確認するフィードバックを追加する。

なお、`EqualComAss` を使用することで、\\(x^{3}+6x^{2}+12x+8\\) も \\(x^{3}+x^{2}6+8+12x\\) も受け入れられる。
項の順序も含めて、例えば \\(x^{3}+6x^{2}+12x+8\\) という特定の順序を求める場合は、評価関数として `CasEqual` を使用する。

## 正当なステップとは何か

現時点では、同値である式はすべて正当なステップとみなされる。

これは明らかに完全に満足のいくものではない。現在の開発段階では「ステップ」の概念は定義されておらず、実際にこれを定義することは非常に困難と思われる。将来的に「ステップサイズ」のチェックのためのより良いツールを開発する予定であり、この方向への貢献は歓迎される。

教師は `length(ta)` を参照することで、学生の解答が十分な長さであるか、あるいは長すぎないかを確認できる。

教師は、学生の解答の中に特定の式が含まれているかどうかを確認できる。この検索を容易にするために、関数 `stack_equiv_find_step(ex, exl)` を提供している。この関数は、`ATEqualComAss` を使用して式 `ex` をリスト `exl` の中から検索し、一致した位置のインデックスのリストを返す。式が含まれていないかどうかだけを知りたい場合は、述語関数 `emptyp` を使用できる。

別の方法として、以下のコードを[フィードバック変数](../../Authoring/Variables.md)に記述することで、因数分解された形式が学生の解答のどこかに存在するかを確認できる。

    foundfac:sublist(ans1,lambda([ex], equationp(ex) and is(rhs(ex)=0)));
    foundfac:ev(any_listp(lambda([ex], second(ATFacForm(lhs(ex),lhs(ex),x))), foundfac), simp);

この段階では、STACK内に組み込まれた機能はまだ少ない状態である。多くのことが可能であるが、上記の例が示すように、問題作成者は他の問題タイプに比べてより多くのMaximaコードを記述する必要がある。

この機能は今後数年かけて、実際の使用を通じて開発されていく予定である。
この機能がどのように動作すべきかについて経験や見解をお持ちの方は、開発者に連絡してほしい。

## 長期的な計画

1. \\(x\\neq a\\) 演算子の定義。定義域から特定の数値を除外するために必要である。
2. \\(x\\in X\\) 演算子の定義（学生使用向け）。
3. 特定のステップの確認など、評価のためのより良いツールの提供。
4. 学生がどのステップを踏んだか、どこで問題が生じたかについて、より良いフィードバックの提供。

長期的には、論文 Sangwin, C.J. __An Audited Elementary Algebra__ The Mathematical Gazette, July 2015 のアイデアを完全に実装する可能性がある。

将来的には、学生が操作を実行するだけでなく、「両辺に \\(a\\) を加える」のように自分が行っていることを説明することも期待されるかもしれない。具体的にどのようにこれを実現するか、教師に提供されるオプションがいかなるものになるかは、今後最も変更される可能性が高い部分である。

また、「模範解答」の概念を導入したいと考えている。STACKが、学生の解答がこの模範解答にどの程度沿っているかを判定できるようになるであろう。
