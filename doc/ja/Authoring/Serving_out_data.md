# データの提供

場合によっては、学生が作業するためのランダムなデータを生成したいことがある。データの量や、学生がそれを他のツールに転送して処理することを想定しているかどうかによって、データを提供する方法は異なる。以下にいくつかの例を示す。

## HTMLテーブル

少量のデータしかない場合は、単にテーブルを出力し、学生にそこからコピー＆ペーストさせることができる。この場合、LaTeXの表現は避けたほうがよい。LaTeXの表現は、学生がコピー＆ペーストする際に問題を引き起こす可能性があるためである。以下は、CASTextの`foreach`ブロックを使ってデータの配列を繰り返し出力する例である。

    [[comment]]これはこのサンプル用のデータを定義しているだけである。問題変数で定義したものを使用してもかまわない。[[/comment]]
    [[define data="(rand(zeromatrix(4,3)+100)-50)/10.0"/]]

    <table>
    [[foreach row="args(data)"]]
     <tr>[[foreach cell="row"]]<td>{#cell#}</td>[[/foreach]]</tr>
    [[/foreach]]
    </table>

    <p>さらに細かな制御も可能である。コピー＆ペーストにあまり影響を与えることなく、値のスタイルを調整できる。</p>
    <table>
    [[foreach row="args(data)"]]
     <tr>[[foreach cell="row"]]
      <td>
      [[if test="cell < 0"]]<span style="color:red;">[[/if]]
      {#cell#}
      [[if test="cell < 0"]]</span>[[/if]]
      </td>
      [[/foreach]]</tr>
    [[/foreach]]
    </table>

## 生のMaximaコード

Maximaやそれに類する構文で使用するコードをそのまま出力したい場合は、`{@...@}`の代わりに`{#...#}`インジェクションを使用できる。これにより、コピー＆ペースト可能な生の形式で出力することができる。ただし、この方法は大量のデータには適していない。行が非常に長くなり、そのテキストを選択すること自体が困難になる可能性があるためである。

## ファイル転送

STACK 4.4以降、ダウンロード可能なテキストファイルを問題内に作成できるようになった。このファイルには、問題のシード値に基づくセッション内で生成された自由形式のCASTextを含めることができるため、学生ごとに異なる（ランダム化された）データを提供することが可能である。なお、ファイル名の拡張子を .csv に指定しない限り、ファイルの内容はすべてプレーンテキストとして提供される。
この機能の主な制限は、「問題テキスト」内でしか機能しないことである。他の場所では使用できず、また、学生の入力内容に応じて動的にファイルの内容を変更することはサポートされていない。

使い方としては、ファイルに含めたい内容を`[[textdownload]]`ブロックで囲む。このブロックにはパラメータ`name`を1つ定義する必要があり、これがダウンロード時のデフォルトのファイル名になる。ブロック内の内容はすべて通常のCASTextとして処理（レンダリング）されるが、注意点として、ブロック外のCASTextで行われた定義は、ブロック内には一切反映されない。もし外部の定義をファイル内でも使いたい場合は、ブロック内でもう一度定義し直すこと。
最終的に、このブロック全体がファイルダウンロード用のURLに置き換わる。通常は、このURLをリンクなどの要素に組み込んで使用することになる。

たとえば、データからCSV文字列を生成する関数を使って、以下のように記述できる。

  /*これらを問題変数に定義する：*/
    lab: ["A","B","C"];
    data: makelist([rand(322)/100.0,rand(600)/100.0,rand(300)/100.0], i, 50);

    [[comment]]問題テキスト内で以下のように使用する。[[/comment]]
    <a href="[[textdownload name="data.csv"]]{@stack_csv_formatter(data,lab)@}[[/textdownload]]">このファイル</a>と...

この関数は文字列を返す。引数として、データを行列またはリストのリスト(二重リスト)の形式で受け取り、ラベルをリストの形式で受け取る。ラベルが不要な場合は`false`を使用すること。また、データに含まれる浮動小数点数の表示形式を制御するために、`stackfltfmt`を使用できる。なお、`labels`はキーワードであるため、ラベルを定義する際の変数名としては使用できない。
