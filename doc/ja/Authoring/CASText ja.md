# CASText

## はじめに

CASTextは、CAS（数式処理システム）対応のテキストです。CASTextは、LaTeX数式やCASコマンドを埋め込むことができる、単なるHTMLです。埋め込まれたCASコマンドは、問題がユーザーに表示される前に実行されます。なお、LaTeXによる数式記述は、単純な構造のみを使用してください。LaTeXの標準機能のうち、サポートされているのはごく一部に限られます。

問題文をはじめ、STACKの問題に含まれるフィールドの多くはCASTextです。

[Basic HTML](http://www.w3schools.com/html/) に関する情報は他の場所で入手可能です。

現在、STACK は LaTeX 自体を処理しません。LaTeX は [MathJax](http://www.mathjax.org/) を使用するなど、さまざまな方法でユーザーのブラウザ上に表示されます。LaTeX の使い方がわからない場合は、[作成者 FAQ](Author_FAQ.md) に簡単な例がいくつかあります。

* `\( .... \)` 記号で囲まれたものはすべて、通常の LaTeX と同様に インライン数式 として扱われます。
* 対応する `\[` と `\]` で囲まれたものは、新しい行の中央に配置される ディスプレイ数式 として扱われます。
* LaTeX 数学環境を示すために `$...$` や `$$...$$` のようなドル記号を使用することはサポートしていません。詳細については、以下の [通貨](CASText.md#currency) に関する注記、および [MathJax](../Installation/Mathjax.md#delimiters) のページを参照してください。
* 数式の外では `\\` のような LaTeX テキスト整形機能を使用せず、代わりに HTML バージョンを使用してください。
* `{@` と `@}` の区切り文字で囲まれたものはすべて CAS によって評価され、その結果を表す LaTeX に置き換えられます。いくつかの注意点があります。
    * デフォルトでは、これは インライン数式 として表示されます。これは LaTeX 記号を使用することに似ています。ただし、`\({@ stuff @}\)` を使用する必要はなく、`{@ stuff @}` だけで十分であることに注意してください。
    * 独自の行の中央に配置されるディスプレイ数式にするには、LaTeX と同様に `\[{@ stuff @}\]` を使用する必要があります。
    * `{@ stuff @}` の外側の `{}` 文字は、出力が LaTeX によって単一のグループとして扱われることを保証するために、出力に残されます。
* `{#` と `#}` の区切り文字で囲まれたものはすべて CAS によって評価され、その結果を表す Maxima の値に置き換えられます。これは基本的に、他のツールで使用可能な生の値や、値の入力方法の例示に使用されます。
* Maxima 変数 `x` が文字列の場合、`{@x@}` は引用符や LaTeX 環境なしで文字列の内容を出力し、`{#x#}` は引用符で囲まれた文字列の内容を出力します。
* リストの括弧なしでカンマ区切りの値が必要な場合は、`{@stack_disp_comma_separate( list )@}` を使用してください。この関数は、リストを中括弧なしの引数の文字列表現に変換します。
* 必要に応じて、1つの LaTeX 数式内に複数の CAS 式を含めることができます。例：`\[ \frac{@p@}{@q@} \]`。多くの問題は、表示レベルではなく CAS のレベルで、例えば CAS 内で変数 `p/q` を定義するのが最善であることに注意してください。これは設計上の判断であり、個々のケースで効率的に解決するためには経験を必要とします。この例については、[途中計算の表示](../CAS/Matrix.md#Showing_working) を参照してください。

以下に例を示します。

    {@sin(1/(1+x^2))@} の導関数は
    \[ \frac{\mathrm{d}}{\mathrm{d}x} \sin \left( \frac{1}{x^2+1} \right) = {@diff(sin(1/(1+x^2)),x)@} \]
    これは <code>{#diff(sin(1/(1+x^2)),x)#}</code> と入力できます。

## 変数 {#Variables}

CASTextでは、[問題変数](Variables.md#Question_variables)フィールドで事前に定義された変数を使用できます。

[ポテンシャル・レスポンス・ツリー](Potential_response_trees.md)のフィールド内でCASTextを使用する場合は、フィードバック変数で定義された変数も使用可能です。

CAS 式が簡略化されるかどうかを制御するには、[選択的簡略化](../CAS/Simplification.md#selective-simplification) に関する詳細を参照してください。

## 問題テキスト {#question_text}

問題テキストは、学生が実際に目にするものです。これは以前のバージョンでは「question text」と呼ばれていました。

これは少し修正された形式の CAStext です。学生が問題に解答できるようにするには、問題テキストに [input](../Authoring/Inputs/index.md) を含める必要があります。

[input](../Authoring/Inputs/index.md) を問題に配置するには、学生の答えが割り当てられる [Maxima](../CAS/Maxima_background.md) 変数の名前を次のタグ内に囲んで配置します。学生の答えが変数 `ans1` に割り当てられる場合は、タグ `[[input:ans1]]` を使用します。また、（学生に表示されるかどうかにかかわらず）検証フィードバックの位置を示すために、対応するタグを配置する必要があります：`[[validation:ans1]]`。正当な変数名であれば何でも使用できます。

* 問題が作成されると、これは適切な [input](../Authoring/Inputs/index.md) に置き換えられます。
* 学生が解答すると、この変数名はそれぞれの [ポテンシャル・レスポンス・ツリー](Potential_response_trees.md) で利用可能になります。
* 入力は、問題テキストに適切なタグを追加することで作成および削除されます。したがって、タグを削除すると問題から入力も削除されるため注意してください。

別のポテンシャル・レスポンス・ツリーを問題に配置するには、適切な名前を選択し、タグ `[[feedback:prt1]]` を追加するだけです。

* これらのタグは、必要に応じて適切なフィードバックに置き換えられます。フィードバックを問題テキストに追加すると、小テストの設定に関係なく、STACK 問題によって常に表示されることに注意してください。編集フォームの「個別のフィードバック」ブロックにタグを配置することを好む場合があるでしょう。個別のフィードバックの利用可能性は、Moodle の小テスト設定によって制御されます。ここでは、フィードバックタグを問題テキスト内の任意の場所（例：特定の入力の隣）に配置できることと、いつ表示されるかを制御することの間に、いくつかの妥協点があります。これは、多くのパートを持つ問題で最も困難です。単一パートの問題については、「個別のフィードバック」ブロックを使用することをお勧めします。
* タグは問題テキスト内の任意の場所に移動できます。
* フィードバックタグを LaTeX 数式内に配置 **しないでください**！
* PRT は、問題テキストに適切なタグを追加することで作成および削除されます。したがって、タグを削除すると問題から PRT も削除され、作業が失われる可能性があるため注意してください。
* 一部のサイトでは大文字と小文字を区別しない（！）データベースを使用しているため、タグが大文字と小文字の違いだけでなく異なるようにしてください。例えば、問題内で `[[input:ans_m]]` と `[[input:ans_M]]` は避けてください。フィードバックタグについても同様です。ほとんどのデータベースは大文字と小文字を区別するため、私たちはこの問題をチェックしません。

## 個別のフィードバック {#Specific_feedback}

Moodle の問題には「個別のフィードバック（specific feedback）」フィールドがあり、これを学生に表示するかどうか、いつ表示するかについての対応する小テスト設定があります。STACK では、通常ここにポテンシャル・レスポンス・ツリー（PRT）、つまりフィードバックアルゴリズムからのフィードバックタグが配置されます。

個別のフィードバックは、任意の問題変数および PRT に依存する可能性がありますが、入力に直接依存してはいけません。

## 全体的なフィードバック / 模範解答 {#General_feedback}

全体的なフィードバック（数学の文脈では通常「模範解答（worked solution）」と呼ばれます）は、学生が問題に解答した後に表示されます。学生が行った反応に依存するフィードバックとは異なり、すべての学生に同じ全体的なフィードバックテキストが表示されます。

全体的なフィードバックは任意の問題変数に依存する可能性がありますが、入力のいずれにも依存してはいけません。また、PRT タグを含んでもいけません。この設計上の決定は制限的ですが、ポテンシャル・レスポンス・ツリーを通じて行われるべきフィードバックと、問題が展開される前に記述できるこの問題の模範解答とを意図的に分離するものです。

## 問題記述 {#Question_description}

問題記述（Question description）フィールドは、教師が選択したあらゆる目的に使用できます。このフィールドはダッシュボードページにのみ表示され、学生には表示されません。

このフィールドはさまざまな目的に使用できます。

1. チューターを助けるための追加の「模範解答」や関連する数学。
2. 教育的根拠、または設計の議論。
3. 同僚への問題改善への協力依頼。これにより、問題に関するメモが問題自体の内部に残ります。
4. チームでの共同作業における変更履歴。問題の編集者には、デザイナー、テクニカルオーサー、レビュアーなどが含まれる場合があります。`[[todo]]` ブロック内のタグは、作業の次の担当者に注意が必要な問題を知らせるのに役立ちます。

注意：一括テスター（bulk tester）には、潜在的な問題を示す `[[todo]]` ブロックをこのフィールドに追加するオプションがあります。詳細については、[問題作成ワークフロー](../STACK_question_admin/Authoring_workflow.md) を参照してください。

これは CASText なので、変数などを含めることができます。ダッシュボードには、生成されたテキスト（変数値を含む）と生の記述フィールド（`[[todo]]` ブロックが残ったまま、削除されない）の両方が表示されます。

## CASText と通貨 {#currency}

通貨にドル記号を使用したいと考えるのは一般的です。しかし、これは数学の区切り文字としてのドル記号の使用と競合します。このため、STACK では数学の区切りにドルを使用することを推奨していません。

通貨にドルを使用する場合は、バックスラッシュで保護する必要があります（`\$`）。そうしないと、CASText の検証に失敗します。

## 事実とヒント

STACK には、事実（fact）とヒント（hint）に使用される組み込みの公式シートがあります。標準テキストは [ファクトシート](../Authoring/Question_blocks/Fact_sheets.md) を使用して追加できます。

## 参考資料

STACK 問題の作成には HTML と LaTeX が必要であり、いくつかの基本的な参考資料が他の場所にあります。

* いくつかの基本的な [HTML](../Reference/HTML.md) の例。
* いくつかの基本的な [LaTeX](../Reference/Latex.md) の例。
* [保険数理記法](../Reference/Actuarial.md) の専用ページがあります。

## CASText 生成関数

CASText 領域に、例えば異なるパラメータを含むあるテキスト（または SVG グラフィック）のいくつかのバージョンなど、反復的なコンテンツのコピーが複数含まれる場合、STACK 関数 `castext` を使用して、問題変数内で CASText 生成関数を定義することが可能です。

例えば、[問題変数](Variables.md) セクション内で、次のように定義します。

    explanation(x,y):=castext("{@x@} を式に代入すると {@y@} になります。");

これは、どの CASText 領域内でも複数回使用できます。

    [[ comment ]] Generated text [[/ comment ]]
    {@explanation(a,b)@}
    {@explanation(c,d)@}

### 注意

* castext の引数は単一のアトミックな文字列でなければなりません。参照ではなく、静的な文字列値である必要があります。
* Maximaは文字列内での改行をそのまま認識するため、castext の引数となる文字列の途中で、そのまま改行して記述できます。
* castext 引数内の引用符には注意が必要です。テキスト内の HTML 属性にはシングルクォーテーション `'...'` を使用してください。
* 2つの castext オブジェクトは `castext_concat()` で結合できます。

## Google Charts

[Google charts](http://code.google.com/apis/chart/) API を使用して、ランダム変数に基づいた URL を作成できます。

![](http://chart.apis.google.com/chart?cht=v&chs=200x100&chd=t:100,100,0,50&chdl=A|B)
